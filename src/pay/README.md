# 支付对接

前提：自建订单系统

## 微信

PC 支付流程

- 前端发起下单接口给后端，后端调用微信native支付下单api获取二维码地址并返回，开始定时轮询确认订单状态（推荐2秒查询一次，查询60s结束）。
- 支付回调通知订单状态/定时轮询微信订单查询接口（以订单下单成功时间为基准，每隔5秒调用《微信支付查单接口》关闭订单）
- 取消订单/支付完成

H5支付流程（非微信客户端的浏览器）

- 前端调用 H5 支付下单接口获取支付链接并跳转（拼接 redirect_url 指定支付完成后跳转的地址），唤起微信支付收银台。
- 取消订单/支付完成会跳转到redirect_url页面，此时调用查询订单API接口确认订单状态。如果支付成功，后台还会收到订单支付成功的通知

jsapi 支付流程（微信客户端内的浏览器）

- 调用下单接口给后端，后端获取预支付ID（prepay_id）后，在微信客户端前端页面调用WeixinJSBridge对象方法调起微信支付界面。
- 取消订单/支付完成会触发前端回调，此时查询订单状态更新业务。如果支付成功，后台还会收到订单支付成功的通知

### 其他

默认订单发起 7 天后，无法再支付。此处可以调用关闭订单结束。
